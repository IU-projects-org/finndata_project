name: Push CI

on: [push]
  
jobs:
  lint:
    name: Lint stage
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    - uses: subosito/flutter-action@v1
      with:
        flutter-version: '2.10.2'
    - run: flutter pub get
    - run: flutter analyze .

  build:
    if: github.event.pull_request.merged == 'true'
    name: Build stage
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    - uses: subosito/flutter-action@v1
      with:
        flutter-version: '2.10.2'
    - run: flutter pub get
    - run: flutter build apk --debug 
    - uses: actions/upload-artifact@v1
      with:
       name: release-apk
       path: build/app/outputs/apk/release/app-release.apk

# The credit for this CI configuration goes to
# https://gist.github.com/aagarwal1012/eb2551683d81cf47d60868ab607520b1